<!DOCTYPE html>
<html class="no-js" lang="pt">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Alterando a data e hora de uma máquina Ubuntu Linux - Leandro Peçanha Scardua</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		
		<meta property="og:title" content="Alterando a data e hora de uma máquina Ubuntu Linux" />
<meta property="og:description" content="Recentemente eu estava fazendo testes no meu sistema de bolão para a Copa do Mundo e precisei alterar a data do sistema para 2018 de modo a averiguar as validações de data. Foi então que percebi que não conseguia fazer isso com facilidade com date/hwclock como fazia antigamente.
Bem, eu havia criado uma regra de validação para que não fosse permitido registrar um palpite para uma partida já encerrada. Um dos critérios para definir isso era a data da partida, ou seja, não é possível alterar a data de uma partida no passado, que já passou." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://leandropecanhascardua.github.io/dicas/alterar-data-e-hora-do-sistema-ubuntu/" />
<meta property="article:published_time" content="2022-05-02T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-05-02T00:00:00+00:00" />

		<meta itemprop="name" content="Alterando a data e hora de uma máquina Ubuntu Linux">
<meta itemprop="description" content="Recentemente eu estava fazendo testes no meu sistema de bolão para a Copa do Mundo e precisei alterar a data do sistema para 2018 de modo a averiguar as validações de data. Foi então que percebi que não conseguia fazer isso com facilidade com date/hwclock como fazia antigamente.
Bem, eu havia criado uma regra de validação para que não fosse permitido registrar um palpite para uma partida já encerrada. Um dos critérios para definir isso era a data da partida, ou seja, não é possível alterar a data de uma partida no passado, que já passou.">
<meta itemprop="datePublished" content="2022-05-02T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2022-05-02T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="759">



<meta itemprop="keywords" content="ubuntu,linux,terminal," />
		
		<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Alterando a data e hora de uma máquina Ubuntu Linux"/>
<meta name="twitter:description" content="Recentemente eu estava fazendo testes no meu sistema de bolão para a Copa do Mundo e precisei alterar a data do sistema para 2018 de modo a averiguar as validações de data. Foi então que percebi que não conseguia fazer isso com facilidade com date/hwclock como fazia antigamente.
Bem, eu havia criado uma regra de validação para que não fosse permitido registrar um palpite para uma partida já encerrada. Um dos critérios para definir isso era a data da partida, ou seja, não é possível alterar a data de uma partida no passado, que já passou."/>


	<link rel="stylesheet" href="/css/style.css">
		<link rel="stylesheet" href="/css/custom.css">

	<link rel="shortcut icon" href="https://leandropecanhascardua.github.io/favicon.ico">

	
		
	 <link rel="stylesheet" href="/post.css">
</head>
<body class="body">
	<header class="header">
	
	<div class="logo logo--mixed">
		<div class="container">
			<a class="logo__link" href="/" title="Leandro Peçanha Scardua" rel="home">
				<div class="logo__item logo__imagebox">
						<img class="logo__img" src="/img/rei-leao.png" alt="Logo image">
					</div><div class="logo__item logo__text">
						<div class="logo__title">Leandro Peçanha Scardua</div>
						<div class="logo__tagline">Tecnologia e Desenvolvimento de sistemas</div>
					</div>
			</a>
		</div>
	</div>

</header>

<nav class="menu">
	<div class="container">
		<button class="menu__btn" aria-haspopup="true" aria-expanded="false" tabindex="0">
			<span class="menu__btn-title" tabindex="-1">Menu</span>
		</button>
		<ul class="menu__list">
			<li class="menu__item">
				<a class="menu__link" href="/">
					
					<span class="menu__text">Home</span>
					
				</a>
			</li>
			<li class="menu__item">
				<a class="menu__link" href="/artigos/">
					
					<span class="menu__text">Artigos</span>
					
				</a>
			</li>
			<li class="menu__item">
				<a class="menu__link" href="/dicas/">
					
					<span class="menu__text">Dicas</span>
					
				</a>
			</li>
		</ul>
	</div>
</nav>



	<div class="container wrapper flex">
		<div class="primary">
		
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Alterando a data e hora de uma máquina Ubuntu Linux</h1>
			<div class="post__meta meta"><div class="meta__item-author meta__item">
	<svg class="meta__icon icon icon-author" width="16" height="16" viewBox="0 0 12 16"><path d="M6 1c2.2 0 3.5 2 3.5 4.5C9.5 7 8.9 8.2 8 9c2.9.8 4 2.5 4 5v1H0v-1c0-2.5 1.1-4.2 4-5-.9-.8-1.5-2-1.5-3.5C2.5 3 3.8 1 6 1z"/></svg><span class="meta__text">Leandro Peçanha Scardua</span>
</div>
<div class="meta__item-datetime meta__item">
	<svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class="meta__text" datetime="2022-05-02T00:00:00Z">02.05.2022</time></div><div class="meta__item-categories meta__item"><svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2l1 2h8v11h-16v-13z"/></svg><span class="meta__text"><a class="meta__link" href="/categories/linux/" rel="category">Linux</a>, <a class="meta__link" href="/categories/dicas/" rel="category">Dicas</a>
	</span>
</div></div>
		</header><div class="content post__content clearfix">
			<p>Recentemente eu estava fazendo testes no meu sistema de bolão para a Copa do Mundo e precisei alterar a data do sistema para 2018 de modo a averiguar as validações de data.
Foi então que percebi que não conseguia fazer isso com facilidade com date/hwclock como fazia antigamente.</p>
<!-- raw HTML omitted -->
<p>Bem, eu havia criado uma regra de validação para que não fosse permitido registrar um palpite para uma partida já encerrada. Um dos critérios para definir isso era a data da partida, ou seja, não é possível alterar a
data de uma partida no passado, que já passou.</p>
<p>Então eu queria ajustar a data do servidor para 13/06/2018 (um dia antes da abertura da Copa do Mundo de Futebol). Primeiro, verificando a data atual:</p>
<blockquote>
<p>leandro@leandro:~$ date<br>
ter 31 mai 2022 14:40:57 -03</p>
</blockquote>
<p>Bem, mudando a data (método antigo) :</p>
<blockquote>
<p>leandro@leandro:~$ sudo date -s &lsquo;20180613&rsquo;<br>
qua 13 jun 2018 00:00:00 -03</p>
</blockquote>
<p>Mas verificando novamente a data&hellip;</p>
<blockquote>
<p>leandro@leandro:~$ date<br>
ter 31 mai 2022 14:42:50 -03</p>
</blockquote>
<p>A data não foi alterada!!!</p>
<p>O motivo disso ter acontecido é que a data e a hora do Ubuntu Linux 20.04 é gerenciada por um serviço de sistema chamado systemd-timesyncd responsável por
automatizar o ajuste de horário na máquina a partir da Internet sem a necessidade de intervenção do usuário.  A sincronização é realizada com um servidor NTP (Network Time Protocol) remoto.</p>
<blockquote>
<p>leandro@leandro:~$ systemctl status systemd-timesyncd<br>
● systemd-timesyncd.service - Network Time Synchronization<br>
Loaded: loaded (/lib/systemd/system/systemd-timesyncd.service; enabled; vendor preset: enabled)<br>
Active: <strong>active (running)</strong> since Tue 2022-05-31 13:30:53 -03; 1h 17min ago<br>
Docs: man:systemd-timesyncd.service(8)<br>
Main PID: 562 (systemd-timesyn)<br>
Status: &ldquo;Initial synchronization to time server [2620:2d:4000:1::3f]:123 (ntp.ubuntu.com).&rdquo;<br>
Tasks: 2 (limit: 4499)<br>
Memory: 1.5M<br>
CGroup: /system.slice/systemd-timesyncd.service<br>
└─562 /lib/systemd/systemd-timesyncd</p>
<p>mai 31 13:30:53 leandro systemd[1]: Starting Network Time Synchronization&hellip;<br>
mai 31 13:30:53 leandro systemd[1]: Started Network Time Synchronization.<br>
mai 31 13:31:24 leandro systemd-timesyncd[562]: Initial synchronization to time server [2620:2d:4000:1::3f]:123 (ntp.ubuntu.com).</p>
</blockquote>
<p>Como podemos ver pela listagem, ele está ativo e operacional e podemos ver com qual servidor o sistema fez a sincronização (ntp.ubuntu.com - 2620:2d:4000:1::3f)
Aqui já temos a resposta para a charada. Basta parar o serviço e usar o método anterior. Felizmente, o SystemD fornece comandos para lidar com os serviços mais comuns de forma menos agressiva,
de modo a facilitar o uso do sistema. Neste caso, o linux
possui o comando <strong>timedatectl</strong> para fazer a interface entre o usuário e o SystemD. Para ver se o comando está instalado:</p>
<blockquote>
<p>leandro@leandro:~$ whereis timedatectl<br>
timedatectl: <strong>/usr/bin/timedatectl</strong> /usr/share/man/man1/timedatectl.1.gz</p>
</blockquote>
<p>O comando timedatectl pode ser usado para pesquisar e modificar o relógio do sistema e suas configurações, além de habilitar e desabilitar os serviços de sincronização. Rodando sem qualquer argumento, temos:</p>
<blockquote>
<p>leandro@leandro:~$ timedatectl<br>
Local time: ter 2022-05-31 14:55:50 -03<br>
Universal time: ter 2022-05-31 17:55:50 UTC<br>
RTC time: ter 2022-05-31 17:55:50<br>
Time zone: America/Sao_Paulo (-03, -0300)<br>
<strong>System clock synchronized: yes</strong><br>
NTP service: active<br>
RTC in local TZ: no</p>
</blockquote>
<p>Podemos ver em destaque que a sincronização está habilitada. Agora vamos ver o status geral do serviço e obter algumas informações sobre o funcionamento:</p>
<blockquote>
<p>leandro@leandro:~$ timedatectl timesync-status<br>
<strong>Server: 2620:2d:4000:1::3f (ntp.ubuntu.com)</strong><br>
Poll interval: 32s (min: 32s; max 34min 8s)<br>
Leap: normal<br>
Version: 4<br>
Stratum: 2<br>
Reference: 11FD227B<br>
Precision: 1us (-25)<br>
Root distance: 1.441ms (max: 5s)<br>
Offset: -208.577ms<br>
Delay: 787.480ms<br>
Jitter: 438.182ms<br>
Packet count: 92<br>
Frequency: -500,000ppm</p>
</blockquote>
<p>Temos a mesma informação de qual o servidor está sendo usado para sincronização (ntp.ubuntu.com - 2620:2d:4000:1::3f) e muito mais detalhes. É um método bem mais elegante de obter essa informação!
Mas nosso interesse aqui não é conhecer o funcionamento do serviço, mas apenas configurar a data e hora do sistema para um valor inválido: 13 de junho de 2018. Então primeiro desabilitamos a sincronização automática:</p>
<blockquote>
<p>leandro@leandro:~$ sudo timedatectl set-ntp false<br>
[sudo] senha para leandro:<br>
leandro@leandro:~$</p>
</blockquote>
<p>Como essa é uma tarefa administrativa, é necessário permissão de administrador(root) no sistema. A seguir configuramos nosso valor inválido para a data do sistema:</p>
<blockquote>
<p>sudo timedatectl set-time &lsquo;2018-01-01 12:00:00&rsquo;<br>
[sudo] senha para leandro:<br>
leandro@leandro:~$</p>
</blockquote>
<p>Conferindo o resultado com o comando <strong>date</strong> como no começo do artigo:</p>
<blockquote>
<p>leandro@leandro:~$ date<br>
seg 01 jan 2018 12:00:01 -02</p>
</blockquote>
<p>conferindo o status do serviço de sincronização podemos ver que não teremos problemas novamente, o sistema não vai corrigir nosso &ldquo;problema&rdquo;:</p>
<blockquote>
<p>leandro@leandro:~$ timedatectl status<br>
Local time: seg 2018-01-01 12:00:27 -02<br>
Universal time: seg 2018-01-01 14:00:27 UTC<br>
RTC time: seg 2018-01-01 14:00:27<br>
Time zone: America/Sao_Paulo (-02, -0200)<br>
System clock synchronized: no<br>
<strong>NTP service: inactive</strong><br>
RTC in local TZ: no</p>
</blockquote>
<p>Quando terminarmos nosso serviço e for necessário voltar para o horário corrente, basta habilitar novamente a sincronização.</p>
<blockquote>
<p>leandro@leandro:~$ sudo  timedatectl  set-ntp true<br>
[sudo] senha para leandro:<br>
leandro@leandro:~$ date<br>
ter 31 mai 2022 15:12:10 -03</p>
</blockquote>
<p>Fonte:</p>
<p>ManPage timedatectl<br>
ManPage systemd-timesyncd</p>

		</div>
		<footer class="post__footer">
			
<div class="post__tags tags clearfix">
	<svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5 0 11V3C0 1.5.8.8.8.8S1.5 0 3 0h8c1.5 0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/></svg>
	<ul class="tags__list">
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/ubuntu/" rel="tag">ubuntu</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/linux/" rel="tag">linux</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/terminal/" rel="tag">terminal</a>
		</li>
	</ul>
</div>
		</footer>
	</article>
</main>

<div class="authorbox clearfix">
	<figure class="authorbox__avatar">
		<img alt="Leandro Peçanha Scardua avatar" src="/img/avatar.png" class="avatar" height="90" width="90">
	</figure>
	<div class="authorbox__header">
		<span class="authorbox__name">Sobre Leandro Peçanha Scardua</span>
	</div>
	<div class="authorbox__description">
		Desenvolvedor e entusiasta de Software Livre
	</div>
</div>




		</div>
		
	</div>
	<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2022 Leandro Peçanha Scardua.
			<span class="footer__copyright-credits">Gerado com <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> com o tema <a href="https://github.com/pfadfinder-konstanz/hugo-dpsg/" rel="nofollow noopener" target="_blank">DPSG</a>.</span>
			
		</div>
		

	</div>
</footer>

	<script async defer src="/js/menu.js"></script>
	<script src="/js/custom.js"></script>
	
	
</body>
</html>
